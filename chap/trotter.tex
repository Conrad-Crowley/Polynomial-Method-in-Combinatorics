\chapter{Szemerédi–Trotter Theorem}

\section{Background}
The Szemerédi–Trotter theorem deals with counting the number of incidences between a finite set of points, $\PP$, in
$\RR^2$ and a finite set of lines, $\LL$, in $\RR^2$. We define 
\[I(\PP,\LL) = \{(p, \ell) \in \PP \times \LL | p \in \ell\}\] 
to be the set of incidences between $\PP$ and $\LL$. 

\section{Examples}
\subsection{Example Finite Fields}
\begin{example}
    

We can not improve beyond trivial bounds in a finite field $\FF$. To see this, consider the set of points $\PP=\FF^2$ and lines 
$\LL = \FF^2$. Every line contains exactly $|\FF|$ many points in $\FF^2$, so we have $|\FF|^3$ incidences. So both sides of the trivial inequality are comparable
$$
I(\PP,\LL) = |\FF|^3 \sim (|\FF|^2)(|\FF|^2)^{1/2} + |\FF|^2.
$$
\end{example}

\subsection{Two Tight Examples in $\RR^2$}
\begin{example} Consider the following collections in $\RR^2$:
    \begin{align*}
    \PP &= \{ (a,b) \in \ZZ^2 \ : \ a\in [1,N], b \in [1,2N^2] \} \\
    \LL &= \{ (x,mx+c) \in \RR^2 \ : \ m,c\in \ZZ, m\in [1,N], c \in [1,N^2] \} \end{align*}
    We have $P= 2N^3$ points and $L = N^3$ lines. Every line in $\LL$ contains $N$ points in $\PP$ so there are
    $N^4$ incidences. Both sides Szemerédi-Trotter are comparable as 
    $$ I(\PP,\LL) = N^4 \sim (N^3)^{\frac{2}{3}} (N^3)^{\frac{2}{3}} \sim P^{2/3} L^{2/3}$$
\end{example}
\todo{diagram?}
\begin{example}
    $R$ \& $2R$ example
\end{example}
\todo{add this example}
\section{The Trivial Bound}
Using the simple fact that two points determine a line, and that every pair of lines intersect in at most one point, 
we can prove the following bound on $I(\PP,\LL)$:
\begin{theorem}[Trivial Incidence Bound]
    $$I(\PP,\LL) \lesssim |\PP|\cdot |\LL|^{\frac{1}{2}} + |L|$$
    and
    $$I(\PP,\LL) \lesssim |\LL|\cdot |\PP|^{\frac{1}{2}} + |P|.$$
\end{theorem}
\begin{proof}
    

We have that 
$$|I(\PP,\LL)| \leq |P|^2 + |L|.$$
To see this, count the lines that have at most one point in $P$ on them. These contribute at most $|\LL|$ incidences.
Every other line has at least two points in $\PP$. The total number of incidences on these lines is at most $|\PP|^2$
as otherwise there would exist a $p\in \PP$ that lies on $> |\PP|$ lines, and each of these lines would have an additional 
point on it. This would imply there are more that $|\PP|$ points, a contradiction. 

We now bound the number of incidences. 

\begin{align*}
    |I(\PP,\LL)|^2 &= \left( \sum_{\ell \in \LL} \sum_{p \in \PP} 1_{p\in \ell} \right)^2 \\
    & \leq |\LL|\cdot \sum_{\ell \in \LL} \left( \sum_{p \in \PP} 1_{p\in \ell} \right)^2  \qquad \text{ (Cauchy Schwartz)}\\
    &= |\LL|\cdot \sum_{p_1,p_2 \in \PP} \sum_{\ell \in \LL}   1_{p_1\in \ell} 1_{p_2\in \ell}    \\
    & \leq |\LL|\cdot ( |I(\PP,\LL)| + |P|^2)\\
    &\leq |\LL|^2 + 2|\LL|\cdot |\PP|^2 \\ 
\end{align*}    
This implies
$$I(\PP,\LL) \lesssim |\PP|\cdot |\LL|^{\frac{1}{2}} + |L|.$$ 

Repeating the above proof, interchanging $\PP$ and $\LL$ achieves the other bound.
\end{proof}

\section{Ham Sandwich Theorems}
\begin{theorem}[General Ham Sandwich Theorem]
Let V be a vector space of continuous functions on $\RR^n$. Let $U_1,U_2,\dots,U_N \subset \RR^n$ be finite volume open sets with $N< \dim V$. For any function $f \in V\backslash \{0\}$, suppose $Z(f)$ has Lebesgue measure zero.

Then there exists a function $f \in V\backslash \{0\}$ that bisects each $U_i$. \label{thm:GenHamSand}
\end{theorem}
\begin{proof}
Define the functions $\{\phi_i\}_{i=1}^N$, $\phi_i: V\backslash \{0\} \to \RR$ by
\[
\phi_i(F) = \text{Vol}(\{x\in U_i | F(x) > 0 \}) - \text{Vol}(\{x\in U_i | F(x) > 0 \})
\]
We notice that each $\phi_i(F) = 0$ if and only if $F$ bisects $U_i$. Notice also that $\phi_i(-F) = -\phi_i(F)$, hence $\phi_i$ is antipodal. We now show each $\phi_i(F)$ is continuous.
It is enough to show that is $U$ is a finite volume open set, that the measure of $\{x\in U| f(x)>0\}$ depends continuously on $f\in V \backslash \{0\}$.

Suppose $f_n \to f$ in $V$ for some $f,f_n \in V \backslash \{0\}$. $f_n$ converges to $f$ in the topology of $V$, so it follows it must converge pointwise. Pick any $\varepsilon >0$. We can find a subset $E\subset U$ so that $f_n \to f$ uniformly pointwise on $U \backslash E$, and $m(E)< \varepsilon$.
By hypothesis, $m(Z(f)) =0$ and $m(U) < \infty$. Hence we can choose $\delta$ such that $m\left(\{x\in U| |f(x)|<\delta\}\right) < \varepsilon$.

Now we choose $n$ sufficiently large such that $|f_n (x) - f(x)| < \delta$ on $U\backslash E$. Then we have \[|m\left(\{x\in U| f_n(x)>0\}\right) - m\left(\{x\in U| f(x)>0\}\right)| < 2 \varepsilon.\] Since $\varepsilon$ was arbitrary each $\phi_i$ is continuous.

We now combine each $\phi_i$ into the map $\phi : V\backslash \{0\} \to \RR^N$. Since $\dim V > N$, let $\dim V = N+1$. Now choose an isomorphism of $V$ with $\RR^{N+1}$, and think of $S^N$ as a subset of $V$.
Now the map $\phi: S^N \to \RR^N$ is antipodal and continuous. By the Borsuk-Ulam theorem, there exists an $F\in S^N \subset V\backslash \{0\}$ such that $\phi(F) = 0$.
\end{proof}

\begin{corollary}[Finite Ham Sandwich Theorem]
    Let $S_1, \dots , S_N$ be finite sets in $\RR^n$ with $N < {{D+n}\choose{n}} = \text{Poly}_D (\RR^n)$. Then there exists a non-zero $P\in \text{Poly}_D (\RR^n)$ that bisects each $S_i$.  \label{thm:FiniteHamSandwich} 
\end{corollary}

\begin{proof}
    For each $\delta>0$, define $U_{i, \delta}$ to be the union of $\delta-balls$ centred at the points of $S_i$. By Theorem \ref{thm:GenHamSand}, we can find a non-zero $P_{\delta}$ with degree less than $D$ that bisects each $U_{i, \delta}$. By rescaling we can assume $P_{\delta} \in S^N \subset \text{Poly}_D (\RR^n) \backslash \{0\}$.
    Since $S^N$ compact, we can find a sequence $\delta_m \to 0$ so that $P_{\delta_{m}}$ converges to $P$ in $S^N$. Since the coefficients of $P_{\delta_{m}}$ converge to $P$, $P_{\delta_{m}}$ converges to $P$ uniformly on compact sets.

    We claim $P$ bisects each $S_i$. By contradiction, suppose $P>0$ on more than half the points of $S_i$, say on the points of $S_i^+$. By choosing $\varepsilon$ sufficiently small, we can assume $P>\varepsilon$ on the $\varepsilon$-ball around each point of $S_i^+$.
    Further, we can choose $\varepsilon$ such that each $\varepsilon$-ball is disjoint. 

    Since $P_{\delta_{m}}$ converges uniformly, we can find $m$ sufficiently large such that $P_{\delta_{m}}>0$ on the $\varepsilon$-ball around each point of $S_i^+$. By making $m$ large, we can also arrange that $\delta_n < \varepsilon$.
    Thus $P_{\delta_{m}} > 0$ on more than half the points of $U_{i, \delta_{m}}$.
\end{proof}
\section{Proof of Szemerédi–Trotter Theorem}
\begin{theorem}[Cell Decompositions]
   For any $n$ there exists a constant $c(n)$ such that if $S$ is a finite subset of $\RR^n$ and $D$ is any degree, then there exists
   a polynomial $P$ of degree $D$ such that $\RR \backslash Z(P)$ is a disjoint union of $\lesssim D^n$ open sets $O_i$ each containing
   $\leq c(n) |S|D^{-n}$ points. \label{thm:PolyPartioning}
\end{theorem}

\begin{proof}
We repeatedly apply Corollary \ref{thm:FiniteHamSandwich}. We begin by finding a polynomial $P_1$ of degree 1 that bisects $S$. We partition $\RR \backslash Z(P_1)$
into two disjoint open sets according to the sign of $P_1$, each containing at most $|S|/2$ points. We then bisect both of these sets using another polynomial $P_2$. There are four sign conditions on $P_1$ and $P_2$, and the subset for
each sign condition contains at most $|S|/4$ points of $S$. Continuing this process to define polynomials $P_3, P_4, \dots$, the polynomial $P_j$ bisects $2^{j-1}$ finite sets. By Corollary \ref{thm:FiniteHamSandwich}, we can find $P_j$ with degree
$\lesssim 2^{j/n}$. $\RR \backslash Z (P_1 \cdot P_2 \cdot \dots P_j)$ is the disjoint union of $2^j$ open sets each containing $\leq |S| 2^{-j}$ points. 
Repeating this procedure $J$ times, and defining $P = \prod_{i=1}^{J} P_i$, $\RR^n \backslash Z(P)$ is the disjoint union of $2^J$ open sets each containing $ \leq |S|2^{-J}$
points of $S$. Now we choose $D$ such that $\deg(P) < D$ which is equivalent to $\sum_{j=0}^J c(n) 2^{j/n} \leq D$. But $\sum_{j=0}^J 2^{j/n}$ is a geometric series so we can find $\deg (P) < D$ for $D \leq c(n) 2^{J/n}$. 
The number of points in each $O_i$ is $\leq |S| 2^{-J} \leq c(n) |S| D^{-n}$
\end{proof}

\begin{theorem} [Szemerédi–Trotter Theorem]
    Let $\ES \subset \RR^2$ be a set of $S$ points, and let $\LL \subset \RR^2$ be a set of $L$ lines in $\RR^2$, then their incidences $I(\ES,\LL)$ satisfies
    $$
    I(\ES, \LL) \lesssim (SL)^{2/3} + S + L
    $$ 
\end{theorem}
\begin{lemma} [Trivial Bounds]
    By double counting, we have the following trivial estimates:
    $$
    I(\ES, \LL) \leq L^2 + S,
    $$
    $$
    I(\ES, \LL) \leq S^2 + L.
    $$
    
    
\end{lemma}
\begin{proof}
We need only consider the case $S^{\frac{1}{2}} \leq L \leq S^2$, as otherwise the proof follows immediately from the lemma above. Let $D$ be a degree to be chosen later. By Theorem \ref{thm:PolyPartioning}, there
exists a polynomial $P$ of degree $D$ such that each component of $\RR^2 \backslash Z(P)$ has $\lesssim SD^{-2}$ points. Let $O_i$ denote these components and $\ES_i = \ES \cap O_i$, $\LL_i = \LL \cap O_i$. 
Note that $\ES = \ES_c \cup \ES_z$, $\LL = \LL_c \cup \LL_z$, where $\ES_z, \LL_z$ are the set of points and lines in $Z(P)$ respectively.
$$I(\ES, \LL) \leq I(\ES_c, \LL) + I(\ES_z, \LL_z) + I(\ES_z, \LL_c)$$
If a line $\ell \notin Z(P)$ then it can intersect $P$ at most $D$ times, and so each line intersects at most $D+1$ cells. Hence $\sum L_i \leq (D+1)L$.
\begin{align*}
    I(\ES_c, \LL) &= \sum_i I(\ES_i, \LL_i) \leq \sum_i \ES_i^2 + \sum_i \LL_i\\
    &\lesssim LD + SD^{-2} \sum_i S_i \leq LD + S^2D^{-2}
\end{align*} 
We also have by our lemma
$$I(\ES_z, \LL_z) \leq S + D^2$$
and finally $$I(\ES_z, \LL_c) \leq LD.$$
Together we have now 
$$I(\ES, \LL) \lesssim LD + S^2D^{-2} +S + D^2.$$
We optimise $D$ in $LD + S^2D^{-2}$ by making both terms comparable and hence $D \sim S^{\frac{2}{3}} L^{-\frac{1}{3}}$. From our restriction $S^{\frac{1}{2}} \leq L \leq S^2$ we have $S^{\frac{2}{3}} L^{-\frac{1}{3}} \geq 1$
and $D^2 \sim S^{\frac{4}{3}} L^{-\frac{2}{3}} \leq S$ so we achieve
$$I(\ES, \LL) \lesssim (SL)^{2/3} + S $$
\end{proof}